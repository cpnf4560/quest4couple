<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Sexy Question Packs - Completo</title>
<style>
body { 
  font-family: Arial, sans-serif; 
  margin: 8px; 
  background: 
    radial-gradient(circle at 15% 25%, rgba(214, 51, 132, 0.35) 0%, transparent 35%),
    radial-gradient(circle at 85% 75%, rgba(111, 66, 193, 0.30) 0%, transparent 35%),
    radial-gradient(circle at 50% 10%, rgba(38, 198, 218, 0.20) 0%, transparent 35%),
    radial-gradient(circle at 20% 70%, rgba(232, 62, 140, 0.15) 0%, transparent 30%),
    repeating-linear-gradient(
      45deg,
      transparent,
      transparent 15px,
      rgba(255, 255, 255, 0.08) 15px,
      rgba(255, 255, 255, 0.08) 17px
    ),
    repeating-linear-gradient(
      -45deg,
      transparent,
      transparent 30px,
      rgba(214, 51, 132, 0.03) 30px,
      rgba(214, 51, 132, 0.03) 32px
    ),
    linear-gradient(135deg, #e8ecf0 0%, #d1d9e0 100%);
  font-size: 16px; 
  min-height: 100vh;
}
.header { 
  text-align: center; 
  margin-bottom: 20px;
  position: relative;
}

.header::before {
  content: '';
  position: absolute;
  top: -20px;
  left: 0;
  right: 0;
  height: 250px;
  background: 
    radial-gradient(circle at 50% 50%, rgba(214, 51, 132, 0.4) 2px, transparent 2px),
    radial-gradient(circle at 25% 25%, rgba(111, 66, 193, 0.3) 1px, transparent 1px),
    radial-gradient(circle at 75% 75%, rgba(38, 198, 218, 0.25) 1.5px, transparent 1.5px);
  background-size: 40px 40px, 20px 20px, 60px 60px;
  opacity: 0.7;
  z-index: -1;
  pointer-events: none;
}
.logo-section { margin-bottom: 25px; }
.logo { 
  width: 120px; 
  height: 120px; 
  margin-bottom: 10px;
  filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
}
.logo-section h1 { 
  margin: 10px 0 5px 0; 
  font-size: 28px; 
  color: #d63384;
  font-weight: bold;
  text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.tagline { 
  margin: 0; 
  font-size: 16px; 
  color: #6f42c1; 
  font-style: italic;
}
.user-section { margin: 20px 0; }
.user-section label { font-weight: bold; font-size: 16px; color: #495057; }
.user-section input { font-size: 16px; padding: 8px; }
.controls { display: flex; gap: 8px; justify-content: center; margin-bottom: 25px; flex-wrap: wrap; }
.compatibility-section { margin: 20px 0; padding: 20px; border-radius: 10px; }
.super-match { background-color: #d4edda; border-left: 5px solid #28a745; }
.match { background-color: #d1ecf1; border-left: 5px solid #17a2b8; }
.maybe { background-color: #fff3cd; border-left: 5px solid #ffc107; }
.special { background-color: #f8d7da; border-left: 5px solid #dc3545; }
.btn { background: linear-gradient(135deg, #d63384, #e83e8c); color: white; border: none; padding: 12px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; touch-action: manipulation; box-shadow: 0 2px 4px rgba(214, 51, 132, 0.3); transition: all 0.3s ease; }
.btn:hover { background: linear-gradient(135deg, #b02a5b, #d63384); transform: translateY(-1px); box-shadow: 0 4px 8px rgba(214, 51, 132, 0.4); }
.btn-secondary { background: linear-gradient(135deg, #6f42c1, #8e5cc7); }
.btn-secondary:hover { background: linear-gradient(135deg, #5a2d91, #6f42c1); transform: translateY(-1px); }



.pack { 
  margin-bottom: 20px; 
  border-radius: 10px; 
  color: white; 
  overflow: hidden; 
  box-shadow: 0 4px 15px rgba(0,0,0,0.15), 0 1px 3px rgba(0,0,0,0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}
.pack-header { padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; user-select: none; }
.pack-header h2 { margin: 0; font-size: 18px; flex: 1; }
.toggle-icon { font-size: 16px; margin-left: 15px; transition: transform 0.3s; }
.pack-content { max-height: none; overflow: visible; transition: max-height 0.3s ease-out; }
.pack-content.collapsed { max-height: 0; overflow: hidden; }
.romantico { background: linear-gradient(135deg, #ff6b9d, #e83e8c); }
.experiencia { background: linear-gradient(135deg, #a17fe0, #6f42c1); }
.pimentinha { background: linear-gradient(135deg, #ff4081, #d63384); }
.atrevimento { background: linear-gradient(135deg, #ff7043, #e64a19); }
.subdom { background: linear-gradient(135deg, #8e24aa, #673ab7); }
.kinks { background: linear-gradient(135deg, #c62828, #ad1457); }
.poliamor { background: linear-gradient(135deg, #26c6da, #00acc1); }

.question { 
  margin: 5px 15px; 
  padding: 12px; 
  background-color: rgba(255,255,255,0.2); 
  border-radius: 8px; 
  display: flex; 
  align-items: flex-start; 
  gap: 15px; 
  min-height: auto;
}

.question-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.question-text { 
  font-weight: 500; 
  line-height: 1.3; 
  font-size: 15px; 
  margin: 0;
}

.question-options { 
  display: flex; 
  justify-content: space-around; 
  align-items: center; 
  min-width: 200px; 
  flex-shrink: 0;
  padding: 0 10px;
}

/* Estilo das opções individuais */
.option-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.option-label {
  font-size: 12px;
  font-weight: bold;
  text-align: center;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 2px;
}

.question-options input[type="radio"] { 
  width: 20px; 
  height: 20px; 
  cursor: pointer;
  transform: scale(1.2);
}

.comments textarea { 
  width: 100%; 
  height: 35px; 
  padding: 8px; 
  border-radius: 5px; 
  border: 1px solid #ccc; 
  resize: vertical; 
  font-size: 14px; 
  min-height: 35px;
  font-family: inherit;
}

h1 { margin: 10px 0 15px 0; font-size: 24px; }
.collapsed .toggle-icon { transform: rotate(-90deg); }

/* Responsividade Mobile */
@media (max-width: 768px) {
  body { margin: 5px; font-size: 16px; }
  .logo { width: 80px; height: 80px; }
  .logo-section h1 { font-size: 22px; }
  .tagline { font-size: 14px; }
  .controls { gap: 5px; }
  .btn { padding: 10px 12px; font-size: 13px; }
  
  .question { margin: 5px 10px; padding: 10px; }
  .question-text { font-size: 14px; }
    .option-label { 
    font-size: 11px;
  }
  
  .question-options input[type="radio"] { 
    width: 18px; 
    height: 18px; 
  }
  
  .pack-header { padding: 12px 15px; }
  .pack-header h2 { font-size: 16px; }
}

@media (max-width: 480px) {
  .question {
    flex-direction: column;
    align-items: stretch;
  }
  
  .question-options {
    justify-content: space-between;
    margin: 8px 0;
    padding: 0 10px;
    min-width: auto;
  }
}

@media print {
  .controls { display: none; }
  .pack { page-break-inside: avoid; }
}
</style>
</head>
<body>
<div class="header">  <div class="logo-section">
    <img src="./logo.png" alt="Quest4Couple Logo" class="logo" onerror="this.src='./logo.jpg'; this.onerror=null;">
    <h1>Quest4Couple</h1>
    <p class="tagline">Descubram-se juntos 💕</p>
  </div>
  
  <div class="user-section">
    <label for="userName">👤 Seu Nome:</label>
    <input type="text" id="userName" placeholder="Digite seu nome..." style="margin: 0 10px; padding: 5px; border-radius: 3px; border: 1px solid #ccc;">
  </div>
  
  <div class="controls">
    <button class="btn" onclick="toggleAllPacks()">Expandir/Colapsar Todos</button>
    <button class="btn" onclick="saveAnswers()">💾 Guardar Respostas Encriptadas</button>
    <button class="btn" onclick="showCompareSection()">🔀 Comparar com Parceiro/a</button>
    <button class="btn btn-secondary" onclick="generatePDF()">📄 Gerar PDF</button>
    <button class="btn btn-secondary" onclick="sendByEmail()">📧 Enviar por Email</button>
  </div>
    <div id="compareSection" style="display: none; margin: 15px 0; padding: 15px; background: #e9ecef; border-radius: 8px;">
    <h3>🔍 Comparar Respostas do Casal</h3>
    <div style="margin: 10px 0;">
      <label>📁 Carregar SEU arquivo .q4c:</label>
      <input type="file" id="myFile" accept=".q4c" style="margin-left: 10px;">
    </div>
    <div style="margin: 10px 0;">
      <label>📁 Carregar arquivo .q4c do/a parceiro/a:</label>
      <input type="file" id="partnerFile" accept=".q4c" style="margin-left: 10px;">
    </div>
    <div style="margin: 10px 0;">
      <label>🔑 Código de segurança:</label>
      <input type="password" id="securityCode" placeholder="Digite o código usado..." style="margin-left: 10px; padding: 5px; border-radius: 3px; border: 1px solid #ccc;">
    </div>
    <button class="btn" onclick="compareEncryptedAnswers()">🎯 Gerar Relatório de Compatibilidade</button>
    
    <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px; font-size: 11px;">
      💡 <strong>Como funciona:</strong><br>
      1. Cada pessoa responde no seu PC e gera um arquivo .q4c<br>
      2. Partilham os arquivos entre si (email, WhatsApp, etc.)<br>
      3. Qualquer um pode carregar ambos os arquivos aqui e ver o relatório<br>
      4. Usem o mesmo código de segurança que definiram ao guardar
    </div>
  </div>
  
  <div id="compatibilityReport" style="display: none;"></div>
</div>

<script>
function createQuestion(name, text) {
  return `<div class='question'>
    <div class='question-content'>
      <div class='question-text'>${text}</div>
      <textarea placeholder='Comentários (opcional)'></textarea>
    </div>
    <div class='question-options'>
      <div class='option-item'>
        <div class='option-label'>Por favor!</div>
        <input type='radio' name='${name}' value='porfavor'>
      </div>
      <div class='option-item'>
        <div class='option-label'>Yup</div>
        <input type='radio' name='${name}' value='yup'>
      </div>
      <div class='option-item'>
        <div class='option-label'>Meh...</div>
        <input type='radio' name='${name}' value='meh'>
      </div>
      <div class='option-item'>
        <div class='option-label'>Talvez</div>
        <input type='radio' name='${name}' value='talvez'>
      </div>
    </div>
  </div>`;
}

// Função createOptionsHeader removida - agora usamos labels individuais

function createPack(className, title, questions) {
  let questionsHtml = questions.map((q,i) => createQuestion(className+i, q)).join('');
  document.write(`
    <div class='pack ${className}'>
      <div class='pack-header' onclick='togglePack("${className}")'>
        <h2>${title}</h2>
        <span class='toggle-icon'>▼</span>
      </div>      <div class='pack-content' id='${className}-content'>
        ${questionsHtml}
      </div>
    </div>
  `);
}

function togglePack(packId) {
  const content = document.getElementById(packId + '-content');
  const header = content.previousElementSibling;
  const icon = header.querySelector('.toggle-icon');
  
  content.classList.toggle('collapsed');
  header.classList.toggle('collapsed');
}

function toggleAllPacks() {
  const allContents = document.querySelectorAll('.pack-content');
  const isAnyExpanded = Array.from(allContents).some(content => !content.classList.contains('collapsed'));
  
  allContents.forEach(content => {
    const header = content.previousElementSibling;
    if (isAnyExpanded) {
      content.classList.add('collapsed');
      header.classList.add('collapsed');
    } else {
      content.classList.remove('collapsed');
      header.classList.remove('collapsed');
    }
  });
}

function generatePDF() {
  window.print();
}

function printForm() {
  window.print();
}

function sendByEmail() {
  const results = collectFormData();
  const subject = encodeURIComponent('Sexy Question Packs - Respostas');
  const body = encodeURIComponent(`Olá!\n\nAqui estão as minhas respostas ao questionário:\n\n${results}\n\nBeijos! 💕`);
  window.open(`mailto:?subject=${subject}&body=${body}`);
}

function collectFormData() {
  let results = '';
  const packs = document.querySelectorAll('.pack');
  
  packs.forEach(pack => {
    const title = pack.querySelector('h2').textContent;
    results += `\n=== ${title} ===\n\n`;
    
    const questions = pack.querySelectorAll('.question');
    questions.forEach((question, index) => {
      const text = question.querySelector('.question-text').textContent;
      const selectedRadio = question.querySelector('input[type="radio"]:checked');
      const comment = question.querySelector('textarea').value;
      
      if (selectedRadio || comment) {
        results += `${index + 1}. ${text}\n`;
        if (selectedRadio) {
          results += `   Resposta: ${getAnswerText(selectedRadio.value)}\n`;
        }
        if (comment) {
          results += `   Comentário: ${comment}\n`;
        }
        results += '\n';
      }
    });
  });
  
  return results;
}

function getAnswerText(value) {
  const answers = {
    'porfavor': 'Por favor!',
    'yup': 'Yup',
    'meh': 'Meh...',
    'talvez': 'Talvez'
  };
  return answers[value] || value;
}

// Perguntas completas por pack
let packs = {
  romantico: ["Gostarias de receber uma massagem sensual com óleos?", "Achas romântico fazer amor à luz de velas?", "Ficas excitado/a com beijos demorados no pescoço?", "Gostarias de tomar um banho romântico a dois?", "Gostas de ouvir palavras de carinho durante o sexo?", "Fantasiaste em fazer amor na praia ao pôr-do-sol?", "Achas íntimo dormir nu/a com o teu parceiro?", "Gostarias de ser surpreendido/a com lingerie sexy?", "Já imaginaste uma noite num hotel luxuoso só para vocês?", "Gostas de sedução lenta e prolongada?", "Achas excitante acordar com carícias suaves?", "Gostas de sussurros sensuais ao ouvido?", "Gostarias de receber uma carta de amor erótica?", "Fantasias em ser despido/a lentamente?", "Gostas de sexo lento e profundamente conectado?", "Achas especial adormecer abraçados após o sexo?", "Gostarias de experimentar vendas de seda?", "Fantasias em fazer amor num campo com estrelas?", "Gostas de massagens nos pés como preliminar?", "Achas excitante banho de espuma a dois?", "Gostas de provocação discreta em público?", "Gostarias de gravar momentos íntimos (apenas para vocês)?", "Achas romântico sexo ao som de música suave?", "Gostas de beijos longos antes de começar?", "Fantasias em recriar a vossa primeira noite?"],
  experiencia: ["Gostarias de comprar um brinquedo sexual para usarem juntos?", "Achas excitante sexo em todas as divisões da casa?", "Já pensaste em sexo ao ar livre (praia, floresta)?", "Gostarias de um duche erótico a dois?", "Achas sensual fazer striptease um para o outro?", "Gostarias de experimentar lingerie e fotografar?", "Achas excitante sexo em frente a um espelho grande?", "Gostarias de explorar brinquedos com controlo remoto?", "Achas picante sexo surpresa durante tarefas domésticas?", "Gostarias de uma viagem focada em prazer?", "Já pensaste em roleplay de desconhecidos num bar?", "Achas excitante sexo num hotel temático?", "Gostarias de bondage leve com lençóis ou gravatas?", "Achas íntimo ver um filme erótico juntos?", "Gostarias de sexo em locais arriscados (elevador, carro)?", "Achas sensual massagem erótica com óleos?", "Gostarias de criar um álbum secreto de fotos íntimas?", "Já pensaste em sexo na banheira com velas?", "Gostarias de explorar comida (chantilly, mel) no corpo?", "Achas excitante tentar uma posição nova por semana?", "Gostarias de um desafio de 7 experiências em 7 dias?", "Achas ousado gravar um áudio íntimo?", "Gostarias de sexo oral em locais inesperados?", "Achas divertido jogos eróticos de tabuleiro?", "Gostarias de explorar todas as vossas fantasias?"],
  pimentinha: ["Gostarias de receber um striptease privado?", "Achas excitante trocar nudes?", "Gostarias de sexo oral em locais diferentes da casa?", "Fantasias em usar vibrador juntos?", "Já pensaste em algemas de veludo?", "Gostas de ser dominado/a de forma leve?", "Achas excitante sexo em pé contra a parede?", "Gostarias de provocação pública discreta?", "Já imaginaste sexo no carro em local deserto?", "Gostas de óleos corporais durante o sexo?", "Achas excitante gelo e calor alternados?", "Gostarias de sexo oral com venda nos olhos?", "Fantasias em posições do Kamasutra?", "Gostarias de experimentar spanking leve?", "Achas excitante sexo rápido em locais inesperados?", "Gostas de 'dirty talk' suave?", "Fantasias em ver o parceiro/a a masturbar-se?", "Gostarias de sexo com venda e surpresas?", "Já pensaste em plugs anais pequenos?", "Achas íntimo masturbação mútua prolongada?", "Gostas de sexo no duche?", "Fantasias em ser 'apanhado' durante o sexo?", "Gostarias de usar vibrador de controlo remoto?", "Achas excitante roleplay de professor/aluno?", "Gostas de sexo oral como atividade principal?"],
  atrevimento: ["Gostarias de me ver de joelhos a obedecer?", "Achas excitante ser amarrado/a?", "Gostas de ser dominado/a com ordens?", "Já pensaste em algemas metálicas?", "Gostarias de sexo com spanking até ficar marcado?", "Achas excitante ser fotografado/a em poses ousadas?", "Gostarias de obedecer a ordens sexuais por um dia?", "Fantasias em inversão total de papéis?", "Gostas de humilhação verbal leve?", "Achas excitante ser 'brinquedo sexual'?", "Gostarias de jogos de obediência com recompensas?", "Já pensaste em coleira e trela na intimidade?", "Gostas de sexo vendado/a sem saber o que vem?", "Achas excitante ser forçado/a a gemer alto?", "Gostarias de um jogo sem direito a recusa?", "Gostas de palavras obscenas no ouvido?", "Achas viciante a sensação de submissão?", "Gostarias de ser filmado/a a obedecer?", "Fantasias em não decidir nada durante o sexo?", "Gostas de brinquedos de imobilização?", "Achas excitante castigos sexuais?", "Gostarias de obedecer discretamente em público?", "Fantasias em 'ser usado/a' sem pedir?", "Gostas de sexo que começa por surpresa?", "Achas excitante implorar por prazer?"],
  subdom: ["Gostarias de humilhação verbal intensa?", "Achas excitante obedecer em tarefas diárias?", "Gostas de sexo em posições desconfortáveis?", "Fantasias em obedecer mesmo quando não queres?", "Gostarias de edge play (parar antes do orgasmo)?", "Achas excitante ser usado/a como móvel?", "Gostas de cenários de rapto consensual?", "Fantasias em ser amarrado/a e deixado à espera?", "Gostarias de castigo com brinquedos de dor?", "Achas excitante obedecer em público?", "Gostas de ordens sussurradas em lugares públicos?", "Fantasias em ser negado/a até implorar?", "Gostarias de humilhação física (ajoelhar, servir)?", "Achas excitante uma noite inteira sem liberdade?", "Gostas de usar coleira durante um dia normal?", "Fantasias em ser tratado/a como propriedade?", "Gostarias de orgasmo proibido sem permissão?", "Achas excitante fantasias de escravidão?", "Gostas de ordens sexuais por escrito?", "Fantasias em ser 'treinado/a' como submisso/a?", "Gostarias de silêncio obrigatório durante o sexo?", "Achas excitante ser apenas objeto de prazer?", "Gostas de privação sensorial total?", "Fantasias em regras por vários dias?", "Achas excitante contrato de submissão?"],
  kinks: ["Gostarias de experimentar shibari (cordas japonesas)?", "Achas excitante fetiche de pés?", "Gostas de latex ou couro na intimidade?", "Fantasias em ser suspenso/a?", "Gostarias de experimentar gag (mordaça)?", "Achas excitante wax play (cera quente)?", "Gostas de electro play (estimulação suave)?", "Fantasias em needle play (agulhas)?", "Gostarias de fetiche de uniformes?", "Achas excitante foot worship (adoração de pés)?", "Gostas de humilhação erótica?", "Fantasias em tail plug (cauda anal)?", "Gostarias de voyeurismo (ver)?", "Achas excitante exibicionismo controlado?", "Gostas de CBT (tortura de genitais)?", "Fantasias em pegging (mulher com strap-on)?", "Gostarias de fetiche de luvas/meias?", "Achas excitante sensory deprivation?", "Gostas de máscaras fetichistas?", "Fantasias em fisting?", "Gostarias de dominatrix?", "Achas excitante objectificação?", "Gostas de trampling (ser pisado/a)?", "Fantasias em pet play (animal submisso)?", "Gostarias de medical fetish?"],
  poliamor: ["Achas excitante imaginar sexo a três?", "Gostarias de ver-me beijar outra pessoa?", "Já pensaste em sexo com mais de duas pessoas?", "Gostarias de um(a) amante em comum?", "Achas excitante ver-me receber prazer de outro/a?", "Gostarias de observar encontros poliamorosos?", "Fantasias com triângulos amorosos?", "Gostarias de sexo em grupo com regras?", "Achas excitante partilhar-me com consentimento?", "Gostas de ver-me ser desejado/a por outros?", "Gostarias de sexo com pessoas do mesmo género?", "Já pensaste em parceiro/a fixo só para sexo?", "Gostas de swing em locais privados?", "Achas excitante ser observador/a durante sexo a três?", "Gostarias de ver-me ter orgasmo com outra pessoa?", "Fantasias em partilhar encontros com outros casais?", "Gostarias de triângulos amorosos duradouros?", "Achas excitante sexo com parceiros diferentes na mesma noite?", "Gostas de resorts ou festas privadas?", "Já pensaste em amantes separados com conhecimento?", "Gostarias de orgias privadas com regras?", "Achas excitante inversão de papéis em grupo?", "Gostas de encontros secretos discretos?", "Fantasias em experiências poliamorosas no estrangeiro?", "Gostarias de uma rede poliamorosa com confiança?"]
};

for (let key in packs) {
  let titles = {romantico: '❤️ Romântico & Fantasias', experiencia: '🔥 Experiência a 2', pimentinha: '🌶️ Pimentinha', atrevimento: '⚡ Atrevimento', subdom: '🔐 Sub/Dom', kinks: '🎭 Kinks & Fetiches', poliamor: '💞 Poliamor'};
  createPack(key, titles[key], packs[key]);
}

// Funcionalidades para casal
function saveAnswers() {
  const userName = document.getElementById('userName').value.trim();
  if (!userName) {
    alert('Por favor, digite seu nome primeiro!');
    return;
  }
  
  const answers = collectAnswersData();
  if (Object.keys(answers).length === 0) {
    alert('Responda pelo menos a algumas perguntas antes de guardar!');
    return;
  }
  
  // Pedir código de segurança
  const securityCode = prompt(`🔐 Digite um código de segurança que vocês dois conhecem:\n(Ex: data de nascimento, nome de animal, etc.)\n\nEste código será usado para desencriptar as respostas.`);
  
  if (!securityCode || securityCode.trim().length < 3) {
    alert('❌ Código deve ter pelo menos 3 caracteres!');
    return;
  }
  
  const data = {
    name: userName,
    timestamp: new Date().toISOString(),
    answers: answers,
    totalQuestions: Object.keys(answers).length
  };
  
  // Encriptar os dados
  const encryptedData = encryptData(JSON.stringify(data), securityCode.trim());
  
  const blob = new Blob([encryptedData], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `quest4couple_${userName.toLowerCase().replace(/\s+/g, '_')}.q4c`;
  a.click();
  URL.revokeObjectURL(url);
  
  alert(`✅ Arquivo encriptado de ${userName} guardado com sucesso!\n\n🔒 Extensão: .q4c (Quest4Couple)\n💾 Partilhe este arquivo com seu/sua parceiro/a\n🔑 Não esqueça o código de segurança: "${securityCode}"`);
}

function collectAnswersData() {
  const answers = {};
  const questions = document.querySelectorAll('.question');
  
  questions.forEach(question => {
    const selectedRadio = question.querySelector('input[type="radio"]:checked');
    const comment = question.querySelector('textarea').value;
    const text = question.querySelector('.question-text').textContent;
    
    if (selectedRadio) {
      answers[text] = {
        response: selectedRadio.value,
        comment: comment || ''
      };
    }
  });
  
  return answers;
}

function showCompareSection() {
  const section = document.getElementById('compareSection');
  section.style.display = section.style.display === 'none' ? 'block' : 'none';
}

// Função de encriptação simples
function encryptData(text, key) {
  let result = '';
  for (let i = 0; i < text.length; i++) {
    const charCode = text.charCodeAt(i) ^ key.charCodeAt(i % key.length);
    result += String.fromCharCode(charCode);
  }
  return btoa(result); // Base64 encode
}

// Função de desencriptação
function decryptData(encryptedText, key) {
  try {
    const decoded = atob(encryptedText); // Base64 decode
    let result = '';
    for (let i = 0; i < decoded.length; i++) {
      const charCode = decoded.charCodeAt(i) ^ key.charCodeAt(i % key.length);
      result += String.fromCharCode(charCode);
    }
    return result;
  } catch (error) {
    throw new Error('Erro na desencriptação');
  }
}

function compareEncryptedAnswers() {
  const myFileInput = document.getElementById('myFile');
  const partnerFileInput = document.getElementById('partnerFile');
  const securityCode = document.getElementById('securityCode').value.trim();
  
  if (!myFileInput.files[0]) {
    alert('📁 Selecione SEU arquivo .q4c!');
    return;
  }
  
  if (!partnerFileInput.files[0]) {
    alert('📁 Selecione o arquivo .q4c do/a seu/sua parceiro/a!');
    return;
  }
  
  if (!securityCode) {
    alert('🔑 Digite o código de segurança!');
    return;
  }
  
  // Ler primeiro arquivo (seu)
  const reader1 = new FileReader();
  reader1.onload = function(e1) {
    // Ler segundo arquivo (parceiro/a)
    const reader2 = new FileReader();
    reader2.onload = function(e2) {
      try {
        // Desencriptar ambos os arquivos
        const myDecrypted = decryptData(e1.target.result, securityCode);
        const partnerDecrypted = decryptData(e2.target.result, securityCode);
        
        const myData = JSON.parse(myDecrypted);
        const partnerData = JSON.parse(partnerDecrypted);
        
        generateCompatibilityReport(myData.name, myData.answers, partnerData.name, partnerData.answers);
        
      } catch (error) {
        alert('❌ Erro ao desencriptar os arquivos!\n\n' +
              'Possíveis causas:\n' +
              '• Código de segurança incorreto\n' +
              '• Arquivos corrompidos\n' +
              '• Arquivos não são do Quest4Couple\n\n' +
              'Verifique o código e tente novamente.');
      }
    };
    reader2.readAsText(partnerFileInput.files[0]);
  };
  reader1.readAsText(myFileInput.files[0]);
}

function compareAnswers() {
  // Manter função antiga para compatibilidade
  compareEncryptedAnswers();
}

function generateCompatibilityReport(user1, answers1, user2, answers2) {
  const compatibility = analyzeCompatibility(answers1, answers2);
  const reportDiv = document.getElementById('compatibilityReport');
  
  let html = `
    <div class="compatibility-section super-match">
      <h2>🔥 RELATÓRIO DE COMPATIBILIDADE</h2>
      <h3>💕 ${user1} & ${user2}</h3>
      <p><strong>Data:</strong> ${new Date().toLocaleDateString('pt-PT')}</p>
    </div>
  `;
  
  if (compatibility.superMatches.length > 0) {
    html += `
      <div class="compatibility-section super-match">
        <h3>🌟 SUPER MATCHES - Ambos querem MUITO! (${compatibility.superMatches.length})</h3>
        <ul>
          ${compatibility.superMatches.map(item => `<li><strong>${item}</strong></li>`).join('')}
        </ul>
      </div>
    `;
  }
  
  if (compatibility.matches.length > 0) {
    html += `
      <div class="compatibility-section match">
        <h3>✅ MATCHES - Compatíveis para experimentar (${compatibility.matches.length})</h3>
        <ul>
          ${compatibility.matches.map(item => `<li>${item}</li>`).join('')}
        </ul>
      </div>
    `;
  }
  
  if (compatibility.special.length > 0) {
    html += `
      <div class="compatibility-section special">
        <h3>💝 ESPECIAIS - Um quer MUITO (aparecem sempre) (${compatibility.special.length})</h3>
        <ul>
          ${compatibility.special.map(item => `<li><em>${item}</em></li>`).join('')}
        </ul>
      </div>
    `;
  }
  
  if (compatibility.maybes.length > 0) {
    html += `
      <div class="compatibility-section maybe">
        <h3>🤔 PARA CONSIDERAR - Ambos em dúvida (${compatibility.maybes.length})</h3>
        <ul>
          ${compatibility.maybes.map(item => `<li>${item}</li>`).join('')}
        </ul>
      </div>
    `;
  }
  
  html += `
    <div class="compatibility-section">
      <h3>📊 ESTATÍSTICAS</h3>
      <p><strong>Total de respostas comparadas:</strong> ${compatibility.total}</p>
      <p><strong>Nível de compatibilidade:</strong> ${Math.round(compatibility.compatibilityScore)}%</p>
    </div>
  `;
  
  reportDiv.innerHTML = html;
  reportDiv.style.display = 'block';
  reportDiv.scrollIntoView({ behavior: 'smooth' });
}

function analyzeCompatibility(answers1, answers2) {
  const superMatches = [];
  const matches = [];
  const special = [];
  const maybes = [];
  let total = 0;
  let compatible = 0;
  
  for (const question in answers1) {
    if (answers2[question]) {
      total++;
      const resp1 = answers1[question].response;
      const resp2 = answers2[question].response;
      
      if (resp1 === 'porfavor' && resp2 === 'porfavor') {
        superMatches.push(question);
        compatible += 2;
      } else if (resp1 === 'porfavor' || resp2 === 'porfavor') {
        if ((resp1 === 'porfavor' && ['yup', 'talvez'].includes(resp2)) ||
            (resp2 === 'porfavor' && ['yup', 'talvez'].includes(resp1))) {
          matches.push(question);
          compatible += 1.5;
        } else {
          special.push(question); // "Por favor!" aparece sempre
          compatible += 1;
        }
      } else if (resp1 === 'yup' && resp2 === 'yup') {
        matches.push(question);
        compatible += 1.5;
      } else if ((resp1 === 'yup' && resp2 === 'talvez') || (resp1 === 'talvez' && resp2 === 'yup')) {
        matches.push(question);
        compatible += 1;
      } else if (resp1 === 'talvez' && resp2 === 'talvez') {
        maybes.push(question);
        compatible += 0.5;
      }
    }
  }
  
  const compatibilityScore = total > 0 ? (compatible / (total * 2)) * 100 : 0;
  
  return {
    superMatches,
    matches,
    special,
    maybes,
    total,
    compatibilityScore
  };
}

// Iniciar todos os packs minimizados ao carregar a página
window.addEventListener('load', function() {
  const allContents = document.querySelectorAll('.pack-content');
  const allHeaders = document.querySelectorAll('.pack-header');
  
  allContents.forEach(content => {
    content.classList.add('collapsed');
  });
  
  allHeaders.forEach(header => {
    header.classList.add('collapsed');
  });
});
</script>

</body>
</html>